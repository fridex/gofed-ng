<h2>gofed system API</h2>

Here you can find all services currently supported by gofed system. You can use
this API to write your own <a href="#howto">scenarios and services</a>. This
listing is autogenerated based on the latest <a
href="system.json">system.json</a> file.

<button type="button" style="display: block" class="btn pull-right" data-toggle="modal" data-target="#system-json-info">View system.json meta-info</button>

<h3>Computational Services</h3>
<div id="computational-services">
</div>

<h3>Storage Services</h3>
<div id="storage-services">
</div>

<div class="modal fade" id="system-json-info" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">System JSON meta-info</h4>
      </div>
      <div id="api-info" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  jQuery(function($) {
    function get_action_div(action, service) {
      function get_doc(doc) {
        if (doc)
          return doc;
        else
          return "<i>Documentation not available</i>";
      }

      function get_service_source(service) {
        return 'https://github.com/gofed/gofed-ng/tree/master/services/' + service['name'].toLowerCase() + '/service.py';
      }

      function get_param(action) {
        var ret = "";
        for (var i = action['args'].length; i--; ) {
          ret += action['args'][i];
          if (i != 0)
            ret += ", ";
        }

        return ret;
      }

      return $(
'<div class="api-desc">' +
'  <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>' +
'  <code>' + action['name'] + '(' + get_param(action) + ')</code>' +
'  <div class="api-text">' +
'    <p>' + get_doc(action['doc']) + '</p>' +
'    <div class="api-provided-by">' +
'      <strong>Provided by:</strong><code>' + service['name'] + '</code> - ' + get_doc(service['doc']) +
'      <a class="api-ref" href="' + get_service_source(service) +'">[source]<a>' +
'    </div>' +
'  </div>' +
'</div>'
      );
    }

    function print_service(services, node) {
      for (var i = services.length; i--; ) {
        var service = services[i];
        for (var j = service['actions'].length; j--; ) {
          var action = service['actions'][j];
          node.append(get_action_div(action, service));
        }
      }
    }

    function print_json_info(json) {
//'  <dt>git head</dt>' +
//'  <dd>' + json['git_head'] + '</dd>' +
      $('#api-info').append($(
'<dl class="dl-horizontal">' +
'  <dt>Generated by</dt>' +
'  <dd>' + json['author'] + '</dd>' +
'  <dt>Generated on</dt>' +
'  <dd>' + json['hostname'] + '</dd>' +
'  <dt>Generated</dt>' +
'  <dd>' + json['generated'] + '</dd>' +
'  <dt>gofed version</dt>' +
'  <dd>' + json['gofed_version'] + '</dd>' +
'  <dt>Git HEAD</dt>' +
'  <dd>' + json['git_head'] + '</dd>' +
'  <dt>Computational #</dt>' +
'  <dd>' + json['services']['computational'].length + '</dd>' +
'  <dt>Storages #</dt>' +
'  <dd>' + json['services']['storages'].length + '</dd>' +
'  <dt>Services total #</dt>' +
'  <dd>' + (json['services']['storages'].length + json['services']['computational'].length) + '</dd>' +
'</dl>'
      ));
    }

    var json = (function () {
      var json = null;
      $.ajax({
        'url': 'system.json',
        'dataType': "json",
        'success': function (data) {
          print_service(data['services']['computational'], $('#computational-services'));
          print_service(data['services']['storages'], $('#storage-services'));
          print_json_info(data);
        },
        'error': function (e, status, error) {
          alert('Failed to download system.json: ' + error);
        }
      });
    })();
  });
</script>

